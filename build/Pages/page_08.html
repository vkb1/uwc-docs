

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>8.0 Sparkplug-Bridge Operations &mdash;   documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="9.0 Debugging steps" href="page_09.html" />
    <link rel="prev" title="7.0 UWC Modbus Operations" href="page_07.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> 
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="First_pg.html">Legal Disclaimer</a></li>
<li class="toctree-l1"><a class="reference internal" href="page_01.html">1.0  Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="page_02.html">2.0  Before Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="page_03.html">3.0  Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="page_04.html">4.0  Container Configuration setting</a></li>
<li class="toctree-l1"><a class="reference internal" href="page_05.html">5.0  Container Configuration setting</a></li>
<li class="toctree-l1"><a class="reference internal" href="page_06.html">6.0  Site Configurations</a></li>
<li class="toctree-l1"><a class="reference internal" href="page_07.html">7.0     UWC Modbus Operations</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">8.0     Sparkplug-Bridge Operations</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#app-virtual-device-communication">8.1     App (virtual device) communication</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#app-message-topic-format">8.1.1   App Message Topic Format</a></li>
<li class="toctree-l3"><a class="reference internal" href="#app-message-birth">8.1.2   App Message - BIRTH</a></li>
<li class="toctree-l3"><a class="reference internal" href="#app-message-data">8.1.3   App Message - DATA</a></li>
<li class="toctree-l3"><a class="reference internal" href="#app-message-cmd">8.1.4   App Message - CMD</a></li>
<li class="toctree-l3"><a class="reference internal" href="#app-message-death">8.1.5   App Message - DEATH</a></li>
<li class="toctree-l3"><a class="reference internal" href="#app-message-templatedef">8.1.6   App Message - TemplateDef</a></li>
<li class="toctree-l3"><a class="reference internal" href="#start-birth-process">8.1.7   START_BIRTH_PROCESS</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#modbus-real-device-communication">8.2     Modbus (real) device communication</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#support-for-dbirth">8.2.1   Support for DBIRTH</a></li>
<li class="toctree-l3"><a class="reference internal" href="#support-for-ddata">8.2.2   Support for DDATA</a></li>
<li class="toctree-l3"><a class="reference internal" href="#support-for-dcmd">8.2.3   Support for DCMD</a></li>
<li class="toctree-l3"><a class="reference internal" href="#support-for-ddeath">8.2.4   Support for DDEATH</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#sparkplug-messages">8.3     SparkPlug Messages</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#nbirth-message">8.3.1   NBIRTH Message</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ndeath-message">8.3.2   NDEATH Message</a></li>
<li class="toctree-l3"><a class="reference internal" href="#dbirth-message">8.3.3   DBIRTH Message</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ddeath-message">8.3.4   DDEATH Message</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ddata-message">8.3.5   DDATA Message</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ncmd-message">8.3.6   NCMD Message</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="page_09.html">9.0     Debugging steps</a></li>
<li class="toctree-l1"><a class="reference internal" href="page_10.html">10.0    Error Codes</a></li>
<li class="toctree-l1"><a class="reference internal" href="page_11.html">11.0    Steps to flash LFM BIOS</a></li>
<li class="toctree-l1"><a class="reference internal" href="page_12.html">12.0    UWC Gateway to Cloud Communication</a></li>
<li class="toctree-l1"><a class="reference internal" href="page_13.html">13.0    Steps to Apply RT Patch</a></li>
<li class="toctree-l1"><a class="reference internal" href="page_14.html">14.0 Appendix</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html"></a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>8.0     Sparkplug-Bridge Operations</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/Pages/page_08.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="sparkplug-bridge-operations">
<h1>8.0     Sparkplug-Bridge Operations<a class="headerlink" href="#sparkplug-bridge-operations" title="Permalink to this headline">¶</a></h1>
<p>Sparkplug-Bridge implements Eclipse Foundation’s SparkPlug standard.</p>
<p><strong>Refer:</strong> <a class="reference external" href="https://www.eclipse.org/tahu/spec/Sparkplug%20Topic%20Namespace%20and%20State%20ManagementV2.2-with%20appendix%20B%20format%20-%20Eclipse.pdf">https://www.eclipse.org/tahu/spec/Sparkplug%20Topic%20Namespace%20and%20State%20ManagementV2.2-with%20appendix%20B%20format%20-%20Eclipse.pdf</a></p>
<p>This section explains the features in detail. UWC gateway acts as a “node” as per SparkPlug standard. Please note that Sparkplug-Bridge is an under-development feature and hence not all message types are supported from SparkPlug.</p>
<p>This section also explains how information from real device and virtual device is mapped to SparkPlug-formatted data.</p>
<section id="app-virtual-device-communication">
<h2>8.1     App (virtual device) communication<a class="headerlink" href="#app-virtual-device-communication" title="Permalink to this headline">¶</a></h2>
<p>Apps running on UWC platform can be represented as a SparkPlug device to SCADA Master. SCADA Master can monitor, control these apps using SparkPlug mechanism. Sparkplug-Bridge defines following to enable this communication between apps and SCADA Master:</p>
<p>TemplateDef message: This allows providing a definition for a Sparkplug Template i.e., UDT</p>
<p>BIRTH message: This corresponds to a SparkPlug DBIRTH message.</p>
<p>DEATH message: This corresponds to a SparkPlug DDEATH message.</p>
<p>DATA message: This corresponds to a SparkPlug DDATA message.</p>
<p>CMD message: This corresponds to a SparkPlug DCMD message.</p>
<p>Apps and Sparkplug-Bridge communicate over internal MQTT using above defined messages.</p>
<section id="app-message-topic-format">
<h3>8.1.1   App Message Topic Format<a class="headerlink" href="#app-message-topic-format" title="Permalink to this headline">¶</a></h3>
<p>MQTT Topic: MESSAGETYPE/APPID/SUBCLASS</p>
<p>Where,</p>
<ul class="simple">
<li><p>MESSAGETYPE: Any of “BIRTH”, “DEATH”, “DATA”, “CMD”</p></li>
<li><p>APPID: Any string e.g., “UWCP”</p></li>
<li><p>SUBCLASS: Any string like wellhead-id e.g., “PL0”. This is not needed in case of DEATH message.</p></li>
</ul>
<p>Sparkplug-Bridge uses following format to represent name of virtual device in SparkPlug Topic namespace:</p>
<p>[value of “APPID” from app message topic] + “-“ + [value of “SUBCLASS” from app message topic]</p>
</section>
<section id="app-message-birth">
<h3>8.1.2   App Message - BIRTH<a class="headerlink" href="#app-message-birth" title="Permalink to this headline">¶</a></h3>
<p>MQTT Topic: BIRTH/APPID/SUBCLASS</p>
<p>Message format:</p>
<p>It is a JSON format message which contains a list of metrics having following fields:</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../_images/table12.png"><img alt="../_images/table12.png" src="../_images/table12.png" style="width: 466.9px; height: 352.79999999999995px;" /></a>
</figure>
<p><strong>Example:</strong></p>
<dl>
<dt>{</dt><dd><p>“metrics”:</p>
<p>[</p>
<blockquote>
<div><p>{</p>
<blockquote>
<div><p>“name”: “Properties/Version”,</p>
<p>“dataType”: “String”,</p>
<p>“value”: “2.0.0.1”,</p>
<p>“timestamp”: 1486144502122</p>
</div></blockquote>
<p>},</p>
<p>{</p>
<blockquote>
<div><p>“name”: “Properties/RTU_Time”,</p>
<p>“dataType”: “String”,</p>
<p>“value”: “1234”,</p>
<p>“timestamp”: 1486144502122</p>
</div></blockquote>
<p>},</p>
<p>{</p>
<blockquote>
<div><p>“name”: “UDT/Prop1”,</p>
<p>“dataType”: “UDT”,</p>
<p>“value”:</p>
<p>{</p>
<blockquote>
<div><p>“udt_ref”:</p>
<p>{</p>
<blockquote>
<div><p>“name”: “custom_udt”,</p>
<p>“version”: “1.0”</p>
</div></blockquote>
<p>},</p>
<p>“metrics”:</p>
<p>[</p>
<blockquote>
<div><p>{</p>
<blockquote>
<div><p>“name”: “M1”,</p>
<p>“dataType”: “String”,</p>
<p>“value”: “2.0.0.1”,</p>
<p>“timestamp”: 1486144502122</p>
</div></blockquote>
<p>},</p>
<p>{</p>
<blockquote>
<div><p>“name”: “RTU_Time”,</p>
<p>“dataType”: “Int32”,</p>
<p>“value”: 1234,</p>
<p>“timestamp”: 1486144502122</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>],</p>
<p>“parameters”:</p>
<p>[</p>
<blockquote>
<div><p>{</p>
<blockquote>
<div><p>“name”: “P1”,</p>
<p>“dataType”: “String”,</p>
<p>“value”: “P1Val”</p>
</div></blockquote>
<p>},</p>
<p>{</p>
<blockquote>
<div><p>“name”: “P2”,</p>
<p>“dataType”: “Int32”,</p>
<p>“value”: 100</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>]</p>
</dd>
</dl>
<p>}</p>
<p><strong>Data Flow</strong>:</p>
<p>This message is published by App over MQTT broker and subscribed by Sparkplug-Bridge. This message provides information about all metrics related to a SUBCLASS which App wants to expose to a SCADA Master.</p>
<p>Sparkplug-Bridge publishes a DBIRTH message to SCADA Master if metrics contain a new metric or if datatype of any of metrics is changed.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>If the App publishes multiple BIRTH messages for a SUBCLASS, then Sparkplug-Bridge remembers all metrics reported in all BIRTH messages. Sparkplug-Bridge reports all these metrics to SCADA Master in DBIRTH message. This data with Sparkplug-Bridge is cleared on restart of gateway or Sparkplug-Bridge container.</p></li>
<li><p>A DBIRTH message can result in refreshing of data in Sparkplug-Bridge and in SCADA Master. Hence, it is recommended for an App to provide information about all metrics in one BIRTH message. App should avoid using multiple BIRTH messages for same SUBCLASS.</p></li>
<li><p>If App wants to publish a metric of type “UDT”, the definition of “UDT” should be provided prior to publishing the BIRTH message. UDT definition can be provided using “TemplateDef” message, explained in subsequent section.</p></li>
</ul>
</div>
<p>Following information is required as a part of “value” key when UDT type is used:</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../_images/table13.png"><img alt="../_images/table13.png" src="../_images/table13.png" style="width: 466.2px; height: 298.2px;" /></a>
</figure>
</section>
<section id="app-message-data">
<h3>8.1.3   App Message - DATA<a class="headerlink" href="#app-message-data" title="Permalink to this headline">¶</a></h3>
<p>MQTT Topic: DATA/APPID/SUBCLASS</p>
<p>Message format:</p>
<p>It is a JSON format message which contains a list of metrics having following fields:</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../_images/table14.png"><img alt="../_images/table14.png" src="../_images/table14.png" style="width: 464.79999999999995px; height: 420.0px;" /></a>
</figure>
<p><strong>Example:</strong></p>
<p>{</p>
<blockquote>
<div><p>“metrics”:</p>
<p>[</p>
<blockquote>
<div><p>{</p>
<blockquote>
<div><p>“name”: “Properties/Version”,</p>
<p>“dataType”: “String”,</p>
<p>“value”: “5.0.0.1”,</p>
<p>“timestamp”: 1486144502122</p>
</div></blockquote>
<p>},</p>
<p>{</p>
<blockquote>
<div><p>“name”: “UDT/Prop1”,</p>
<p>“dataType”: “UDT”,</p>
<p>“value”:</p>
<p>{</p>
<blockquote>
<div><p>“metrics”:</p>
<p>[</p>
<blockquote>
<div><p>{</p>
<blockquote>
<div><p>“name”: “M1”,</p>
<p>“dataType”: “String”,</p>
<p>“value”: “a.b”,</p>
<p>“timestamp”: 1486144502122</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>}</p>
<p>Data Flow:</p>
<p>This message is published by App over MQTT broker and subscribed by Sparkplug-Bridge. This message provides information about all changed metrics related to a SUBCLASS.</p>
<p>Sparkplug-Bridge publishes a DDATA message to SCADA Master if value of any of “known metrics” is changed compared to last known value from a BIRTH or DATA message.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A “known metric” is one which was reported in BIRTH message. The name and datatype for a “known metric” in DATA message and BIRTH message shall match.</p>
</div>
</section>
<section id="app-message-cmd">
<h3>8.1.4   App Message - CMD<a class="headerlink" href="#app-message-cmd" title="Permalink to this headline">¶</a></h3>
<p>MQTT Topic: CMD/APPID/SUBCLASS</p>
<p>Message format:</p>
<p>It is a JSON format message which contains a list of metrics having following fields:</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../_images/table15.png"><img alt="../_images/table15.png" src="../_images/table15.png" style="width: 464.09999999999997px; height: 419.29999999999995px;" /></a>
</figure>
<p><strong>Example:</strong></p>
<p>{</p>
<blockquote>
<div><p>“metrics”:</p>
<p>[</p>
<blockquote>
<div><p>{</p>
<blockquote>
<div><p>“name”: “Properties/Version”,</p>
<p>“dataType”: “String”,</p>
<p>“value”: “7.0.0.1”,</p>
<p>“timestamp”: 1486144502122</p>
</div></blockquote>
<p>},</p>
<p>{</p>
<blockquote>
<div><p>“name”: “UDT/Prop1”,</p>
<p>“dataType”: “UDT”,</p>
<p>“metrics”:</p>
<p>[</p>
<blockquote>
<div><p>{</p>
<blockquote>
<div><p>“dataType”: “Int32”,</p>
<p>“value”: 4,</p>
<p>“name”: “RTU_Time”,</p>
<p>“timestamp”: 1614512107195</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>],</p>
<p>“timestamp”: 1614512107195</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>}</p>
<p>Data Flow:</p>
<p>This message is published by Sparkplug-Bridge over MQTT broker and subscribed by App. This message provides information about control command i.e., DCMD received from SCADA Master.</p>
<p>Sparkplug-Bridge publishes a CMD message to the App if DCMD message is received for a known metric.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A “known metric” is one which was reported in BIRTH message. The name and datatype for a “known metric” in DCMD message and BIRTH message shall match.</p>
</div>
</section>
<section id="app-message-death">
<h3>8.1.5   App Message - DEATH<a class="headerlink" href="#app-message-death" title="Permalink to this headline">¶</a></h3>
<p>MQTT Topic: DEATH/APPID</p>
<p>Message format:</p>
<p>It is a JSON format message which contains the following fields:</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../_images/table16.png"><img alt="../_images/table16.png" src="../_images/table16.png" style="width: 464.79999999999995px; height: 133.7px;" /></a>
</figure>
<p><strong>Example:</strong></p>
<p>{</p>
<blockquote>
<div><p>“timestamp”: 1486144502122</p>
</div></blockquote>
<p>}</p>
<p>Data Flow:</p>
<p>When App’s connection with MQTT broker breaks then this message is published.</p>
<p>Sparkplug-Bridge publishes a DDEATH message to SCADA Master for all known SUBCLASS associated with the App.</p>
</section>
<section id="app-message-templatedef">
<h3>8.1.6   App Message - TemplateDef<a class="headerlink" href="#app-message-templatedef" title="Permalink to this headline">¶</a></h3>
<p>MQTT Topic: TemplateDef</p>
<p>Message format:</p>
<p>It is a JSON format message which contains a list of metrics having following fields:</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../_images/table17_1.png"><img alt="../_images/table17_1.png" src="../_images/table17_1.png" style="width: 466.2px; height: 581.6999999999999px;" /></a>
</figure>
<figure class="align-center">
<a class="reference internal image-reference" href="../_images/table17_2.png"><img alt="../_images/table17_2.png" src="../_images/table17_2.png" style="width: 466.2px; height: 65.8px;" /></a>
</figure>
<p><strong>Example:</strong></p>
<p>{</p>
<blockquote>
<div><p>“udt_name”: “custom_udt”,</p>
<p>“version”: “1.0”,</p>
<p>“metrics”:
[</p>
<blockquote>
<div><p>{</p>
<blockquote>
<div><p>“name”: “M1”,</p>
<p>“dataType”: “String”,</p>
<p>“value”: “”</p>
</div></blockquote>
<p>},</p>
<p>{</p>
<blockquote>
<div><p>“name”: “RTU_Time”,</p>
<p>“dataType”: “Int32”,</p>
<p>“value”: 0</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>],</p>
<p>“parameters”:
[</p>
<blockquote>
<div><p>{</p>
<blockquote>
<div><p>“name”: “P1”,</p>
<p>“dataType”: “String”,</p>
<p>“value”: “”</p>
</div></blockquote>
<p>},</p>
<p>{</p>
<blockquote>
<div><p>“name”: “P2”,</p>
<p>“dataType”: “Int32”,</p>
<p>“value”: 0</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>}</p>
<p>Data Flow:</p>
<p>App should use this message to provide definition of a Sparkplug Template i.e., UDT. UDT definitions are published as a part of NBIRTH message. Hence, after receiving a UDT definition, Sparkplug-Bridge publishes NDEATH and then NBIRTH to SCADA-Master.</p>
</section>
<section id="start-birth-process">
<h3>8.1.7   START_BIRTH_PROCESS<a class="headerlink" href="#start-birth-process" title="Permalink to this headline">¶</a></h3>
<p>MQTT Topic: START_BIRTH_PROCESS</p>
<p>Message format:</p>
<p>It is an empty JSON format message:</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>Field Name</strong></p></td>
<td><p><strong>Datatype</strong></p></td>
<td><p><strong>Description</strong></p></td>
</tr>
</tbody>
</table>
<p><strong>Example:</strong></p>
<p>{</p>
<p>}</p>
<p>Data Flow:</p>
<p>This message is published by Sparkplug-Bridge over MQTT broker and subscribed by App. This message tells the App to publish following:</p>
<ul class="simple">
<li><p>Definition of Sparkplug Templates i.e., UDT which are used by App in BIRTH message</p></li>
<li><p>BIRTH messages for all SUBCLASS the App is having. The App shall publish BIRTH messages on receiving START_BIRTH_PROCESS message.</p></li>
</ul>
<p>START_BIRTH_PROCESS message will be sent on restart of Sparkplug-Bridge container or whenever Sparkplug-Bridge container needs to refresh the data that it maintains for virtual devices.</p>
</section>
</section>
<section id="modbus-real-device-communication">
<h2>8.2     Modbus (real) device communication<a class="headerlink" href="#modbus-real-device-communication" title="Permalink to this headline">¶</a></h2>
<p>Modbus devices present in network are reported to SCADA Master using SparkPlug mechanism.</p>
<p>Apps and Sparkplug-Bridge communicate over internal MQTT using above defined messages.</p>
<section id="support-for-dbirth">
<h3>8.2.1   Support for DBIRTH<a class="headerlink" href="#support-for-dbirth" title="Permalink to this headline">¶</a></h3>
<p>Data from device YML configuration files is used to form a DBIRTH message for real devices at the start of Sparkplug-Bridge container. One datapoint YML file corresponds to one SparkPlug template definition. One real Modbus device contains one metric of type SparkPlug template. The SparkPlug template in turn contains all other metrics which correspond to datapoints mentioned in datapoints-YML file.</p>
</section>
<section id="support-for-ddata">
<h3>8.2.2   Support for DDATA<a class="headerlink" href="#support-for-ddata" title="Permalink to this headline">¶</a></h3>
<p>Data from polling operation published by MQTT-Bridge over internal MQTT is used to determine a change in value of any of metrics associated with a real device. If a change is detected, a DDATA message is published by Sparkplug-Bridge.</p>
</section>
<section id="support-for-dcmd">
<h3>8.2.3   Support for DCMD<a class="headerlink" href="#support-for-dcmd" title="Permalink to this headline">¶</a></h3>
<p>When a DCMD message is received from a SCADA Master for a real device for a “known metric”, then an on-demand write operation is initiated by SCADA and sent to MQTT-Bridge over internal MQTT.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>A “known metric” is one which is present in device YML configuration file. The name and datatype for a “known metric” in DCMD message and YML file shall match.</p></li>
<li><p>A DCMD message can result in multiple on-demand write operations.</p></li>
</ul>
</div>
</section>
<section id="support-for-ddeath">
<h3>8.2.4   Support for DDEATH<a class="headerlink" href="#support-for-ddeath" title="Permalink to this headline">¶</a></h3>
<p>Data from polling operation published by MQTT-Bridge over internal MQTT is used to determine whether a device is reachable or not, based on error_code. If device unreachable error-code is found, a DDEATH message is published by Sparkplug-Bridge. When correct values are found, a DBIRTH message is published.</p>
</section>
</section>
<section id="sparkplug-messages">
<h2>8.3     SparkPlug Messages<a class="headerlink" href="#sparkplug-messages" title="Permalink to this headline">¶</a></h2>
<p>Refer SparkPlug standard for more information.</p>
<section id="nbirth-message">
<h3>8.3.1   NBIRTH Message<a class="headerlink" href="#nbirth-message" title="Permalink to this headline">¶</a></h3>
<p>NBIRTH is Node-Birth.</p>
<p>On start-up, Sparkplug-Bridge module publishes this message over MQTT broker. The message is published in SparkPlug encoded format.</p>
<p>For Modbus real device, one datapoint YML file corresponds to one SparkPlug template. These template definitions are sent in NBIRTH message. DBIRTH message for Modbus device specifies a particular SparkPlug template.</p>
<p>Following are sample contents in simplified JSON format:</p>
<p><strong>Topic:</strong> <em>spBv1.0/UWC nodes/NBIRTH/RBOX510-00</em></p>
<p><strong>Message:</strong></p>
<dl>
<dt>{</dt><dd><p>“timestamp”: 1608243262157,</p>
<p>“metrics”:</p>
<blockquote>
<div><p>[</p>
<blockquote>
<div><dl>
<dt>{</dt><dd><p>“name”: “Name”,</p>
<p>“timestamp”: 1608243262157,</p>
<p>“dataType”: “String”,</p>
<p>“value”: “SPARKPLUG-BRIDGE”</p>
</dd>
</dl>
<p>},</p>
<p>{</p>
<blockquote>
<div><p>“name”: “bdSeq”,</p>
<p>“timestamp”: 1608243262157,</p>
<p>“dataType”: “UInt64”,</p>
<p>“value”: 0</p>
</div></blockquote>
<p>},</p>
<p>{</p>
<blockquote>
<div><p>“name”: “Node Control/Rebirth”,</p>
<p>“timestamp”: 1608243262157,</p>
<p>“dataType”: “Boolean”,</p>
<p>“value”: false</p>
</div></blockquote>
<p>},</p>
<p>{</p>
<blockquote>
<div><p>“name”: “iou_datapoints”,</p>
<p>“timestamp”: 1608243262157,</p>
<p>“dataType”: “Template”,</p>
<p>“value”:</p>
<dl>
<dt>{</dt><dd><p>“version”: “1.0.0”,</p>
<p>“reference”: “”,</p>
<p>“isDefinition”: true,</p>
<p>“metrics”:</p>
<p>[</p>
<blockquote>
<div><p>{</p>
<blockquote>
<div><p>“name”: “D1”,</p>
<p>“timestamp”: 1608243262157,</p>
<p>“dataType”: “String”,</p>
<p>“properties”:</p>
<p>{</p>
<blockquote>
<div><p>“Pollinterval”:</p>
<p>{</p>
<blockquote>
<div><p>“type”: “UInt32”,</p>
<p>“value”: 0</p>
</div></blockquote>
<p>},</p>
<p>“Realtime”:</p>
<p>{</p>
<blockquote>
<div><p>“type”: “Boolean”,</p>
<p>“value”: false</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>},</p>
<p>“value”: “”</p>
</div></blockquote>
<p>},</p>
<p>{</p>
<blockquote>
<div><p>“name”: “D2”
,
“timestamp”: 1608243262157,</p>
<p>“dataType”: “String”,</p>
<p>“properties”:</p>
<p>{</p>
<blockquote>
<div><p>“Pollinterval”:</p>
<p>{</p>
<blockquote>
<div><p>“type”: “UInt32”,</p>
<p>“value”: 0</p>
</div></blockquote>
<p>},</p>
<p>“Realtime”:</p>
<p>{</p>
<blockquote>
<div><p>“type”: “Boolean”,</p>
<p>“value”: false</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>},</p>
<p>“value”: “”</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>],</p>
<p>“parameters”:</p>
<p>[</p>
<blockquote>
<div><p>{</p>
<blockquote>
<div><p>“name”: “Protocol”,</p>
<p>“type”: “String”,</p>
<p>“value”: “”</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>]</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
</div></blockquote>
<p>],</p>
<p>“seq”: 0,</p>
<p>“uuid”: “SPARKPLUG-BRIDGE”</p>
</dd>
</dl>
<p>}</p>
</section>
<section id="ndeath-message">
<h3>8.3.2   NDEATH Message<a class="headerlink" href="#ndeath-message" title="Permalink to this headline">¶</a></h3>
<p>NDEATH is Node-Death.</p>
<p>Whenever Sparkplug-Bridge module’s connection with MQTT broker breaks, the MQTT broker publishes this message. The message is published in text format.</p>
<p>Following are sample contents in simplified JSON format:</p>
<p><strong>Topic</strong>: spBv1.0/UWC nodes/NDEATH/RBOX510-00</p>
<p>Message:</p>
<p>{</p>
<blockquote>
<div><p>“timestamp”: 1592306298537,</p>
<p>“metrics”:</p>
<blockquote>
<div><p>[</p>
<blockquote>
<div><p>{</p>
<blockquote>
<div><p>“name”: “bdSeq”,</p>
<p>“alias”: 10,</p>
<p>“timestamp”: 1592306298537,</p>
<p>“dataType”: “UInt64”,</p>
<p>“value”: 0</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
</div></blockquote>
<p>],</p>
<p>“seq”: 0</p>
</div></blockquote>
<p>}</p>
</section>
<section id="dbirth-message">
<h3>8.3.3   DBIRTH Message<a class="headerlink" href="#dbirth-message" title="Permalink to this headline">¶</a></h3>
<p>DBIRTH is Device-Birth.</p>
<p>On start-up, Sparkplug-Bridge module publishes this message over MQTT broker. The message is published in SparkPlug encoded format.</p>
<p>Following are sample contents in simplified JSON format for a Modbus device:</p>
<p>{</p>
<blockquote>
<div><p>“timestamp”: 1608242600219,</p>
<p>“metrics”:</p>
<p>[</p>
<blockquote>
<div><p>{</p>
<blockquote>
<div><p>“name”: “iou”,</p>
<p>“timestamp”: 1608242600219,</p>
<p>“dataType”: “Template”,</p>
<p>“value”:</p>
<dl>
<dt>{</dt><dd><p>“version”: “1.0.0”,</p>
<p>“reference”: “iou_datapoints”,</p>
<p>“isDefinition”: false,</p>
<p>“metrics”:</p>
<p>[</p>
<blockquote>
<div><p>{</p>
<blockquote>
<div><p>“name”: “D1”,</p>
<p>“timestamp”: 1608242599889,</p>
<p>“dataType”: “Int16”,</p>
<p>“properties”:</p>
<p>{</p>
<blockquote>
<div><p>“Scale”:</p>
<p>{</p>
<blockquote>
<div><p>“type”: “Double”,</p>
<p>“value”: 1</p>
</div></blockquote>
<p>},</p>
<blockquote>
<div><p>“Pollinterval”:</p>
<p>{</p>
<blockquote>
<div><p>“type”: “UInt32”,</p>
<p>“value”: 1000</p>
</div></blockquote>
<p>},</p>
<p>“Realtime”:</p>
<p>{</p>
<blockquote>
<div><p>“type”: “Boolean”,</p>
<p>“value”: false</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
</div></blockquote>
<p>},</p>
<p>“value”: 0</p>
</div></blockquote>
<p>},</p>
<p>{</p>
<blockquote>
<div><p>“name”: “D2”,</p>
<p>“timestamp”: 1608242599889,</p>
<p>“dataType”: “Int32”,</p>
<p>“properties”:</p>
<p>{</p>
<blockquote>
<div><p>“Scale”:</p>
<p>{</p>
<blockquote>
<div><p>“type”: “Double”,</p>
<p>“value”: 1</p>
</div></blockquote>
<p>},</p>
<blockquote>
<div><p>“Pollinterval”:</p>
<p>{</p>
<blockquote>
<div><p>“type”: “UInt32”,</p>
<p>“value”: 1000</p>
</div></blockquote>
<p>},</p>
<p>“Realtime”:</p>
<p>{</p>
<blockquote>
<div><p>“type”: “Boolean”,</p>
<p>“value”: false</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
</div></blockquote>
<p>},</p>
<p>“value”: 0</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>],</p>
<p>“parameters”:</p>
<p>[</p>
<blockquote>
<div><p>{</p>
<blockquote>
<div><p>“name”: “Protocol”,</p>
<p>“type”: “String”
,
“value”: “Modbus TCP”</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>]</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>],</p>
<p>“seq”: 1</p>
</div></blockquote>
<p>}</p>
</section>
<section id="ddeath-message">
<h3>8.3.4   DDEATH Message<a class="headerlink" href="#ddeath-message" title="Permalink to this headline">¶</a></h3>
<p>DDEATH is Device-Death.</p>
<p>Sparkplug-Bridge module publishes this message over MQTT broker whenever it detects that device is not reachable. The message is published in SparkPlug encoded format.</p>
<p>Following are sample contents in simplified JSON format:</p>
<p>{</p>
<p>“timestamp”:1599467927490,</p>
<p>“metrics”:[],</p>
<p>“seq”:7</p>
<p>}</p>
</section>
<section id="ddata-message">
<h3>8.3.5   DDATA Message<a class="headerlink" href="#ddata-message" title="Permalink to this headline">¶</a></h3>
<p>DDATA is Device-Data.</p>
<p>Sparkplug-Bridge module publishes this message over MQTT broker whenever it detects a change in value of any of metrics of devices. The message is published in SparkPlug encoded format.</p>
<p>Following are sample contents in simplified JSON format for a Modbus device:</p>
<p>{</p>
<blockquote>
<div><p>“timestamp”: 1608242631070,</p>
<p>“metrics”:</p>
<p>[</p>
<blockquote>
<div><p>{</p>
<blockquote>
<div><p>“name”: “iou”,</p>
<p>“timestamp”: 1608242631070,</p>
<p>“dataType”: “Template”,</p>
<p>“value”:</p>
<dl>
<dt>{</dt><dd><p>“version”: “1.0.0”,</p>
<p>“reference”: “iou_datapoints”,</p>
<p>“isDefinition”: false,</p>
<p>“metrics”:</p>
<p>[</p>
<blockquote>
<div><p>{</p>
<blockquote>
<div><p>“name”: “D1”,</p>
<p>“timestamp”: 1571887474111145,</p>
<p>“dataType”: “String”,</p>
<p>“value”: “0x00”</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>]</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>],</p>
<p>“seq”: 2</p>
</div></blockquote>
<p>}</p>
<p>Following is sample contents in simplified JSON format for a Modbus device with scalefactor applied:</p>
<p>{</p>
<blockquote>
<div><p>“timestamp”: 1621951388659
,
“metrics”:</p>
<p>[</p>
<blockquote>
<div><p>{</p>
<blockquote>
<div><p>“name”: “flowmeter”,</p>
<p>“timestamp”: 1621951388659,</p>
<p>“dataType”: “Template”,</p>
<p>“value”:</p>
<dl>
<dt>{</dt><dd><p>“version”: “1.0.0”,</p>
<p>“reference”: “flowmeter_datapoints”,</p>
<p>“isDefinition”: false,</p>
<p>“metrics”:</p>
<p>[</p>
<blockquote>
<div><p>{</p>
<blockquote>
<div><p>“name”: “D1”,</p>
<p>“timestamp”: 1621951388658,</p>
<p>“dataType”: “Int32”,</p>
<p>“value”: 2910</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>]</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>],</p>
<p>“seq”: 2</p>
</div></blockquote>
<p>}</p>
</section>
<section id="ncmd-message">
<h3>8.3.6   NCMD Message<a class="headerlink" href="#ncmd-message" title="Permalink to this headline">¶</a></h3>
<p>NCMD is Node-Command.</p>
<p>SCADA Master can tell edge node to reinitiate the node birth process. The node starts publishing NBIRTH, DBIRTH messages after receiving NCMD.</p>
<p>Following are sample contents in simplified JSON format:</p>
<p><strong>Topic:</strong> <em>spBv1.0/UWC nodes/NCMD/RBOX510-00</em></p>
<p><strong>Message:</strong></p>
<p>{</p>
<blockquote>
<div><p>“timestamp”: 1615619351980,</p>
<p>“metrics”:</p>
<p>[</p>
<blockquote>
<div><p>{</p>
<blockquote>
<div><p>“name”: “Node Control/Rebirth”,</p>
<p>“timestamp”: 1615619351980,</p>
<p>“dataType”: “Boolean”,</p>
<p>“value”: true</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>],</p>
<p>“seq”: -1</p>
</div></blockquote>
<p>}</p>
</section>
</section>
</section>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="page_09.html" class="btn btn-neutral float-right" title="9.0 Debugging steps" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="page_07.html" class="btn btn-neutral float-left" title="7.0 UWC Modbus Operations" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, APP.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>